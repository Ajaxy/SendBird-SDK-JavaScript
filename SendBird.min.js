/**
 * SendBird JavaScript SDK v2.2.0
 */
var _isLeavingPage=!1;"object"==typeof window&&(window.onbeforeunload=function(){_isLeavingPage=!0}),function(e,n){"use strict";"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():e.sendbird=n()}(this,function(){"use strict";function e(e,n,s,i){var r=new XMLHttpRequest;r.open("POST",e),r.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),r.onload=function(){if(r.status>=t&&r.status<a){var e=r.responseText;s(JSON.parse(e))}else i(r.status,r.statusText)},r.send(JSON.stringify(n))}var n=!1,s=function(e){n&&console.log(e)},i=function(e){e=e||{};for(var n=arguments.length,s=1;n>s;s++)if(arguments[s])for(var i in arguments[s])arguments[s].hasOwnProperty(i)&&(e[i]=arguments[s][i]);return e},t=200,a=400,r=function(){function r(e){return l+"v"+u.replace(/[^(0-9)]/gi,"")+"/"+e}function o(e){return l+"v3/"+e}function c(e){d.app_id=e.app_id,d.guest_id=e.guest_id,d.user_name=e.user_name,d.image_url=void 0==e.image_url||null==e.image_url?"":e.image_url,d.access_token=void 0==e.access_token||null==e.access_token?"":e.access_token,L({successFunc:function(n){e.successFunc(n)},errorFunc:function(n,s){e.errorFunc(n,s)},async:e.async})}var u="1",g="wss://ws.jiver.co:9010",l="https://api.jiver.co/",f=null,p={MESG:"MESG",FILE:"FILE",LOGI:"LOGI",JOIN:"JOIN",SYSM:"SYSM",BRDM:"BRDM",MCUP:"MCUP",READ:"READ",TPST:"TPST",TPEN:"TPEN",PING:"PING",PONG:"PONG"},d={},_={},m=0,v=0,h=null,F=null,y=null,M=0,k=!1,S=0,T=1e4,R=function(e,n){switch(e){case p.MESG:O.onMessageReceived(JSON.parse(n));break;case p.SYSM:O.onSystemMessageReceived(JSON.parse(n));break;case p.FILE:O.onFileMessageReceived(JSON.parse(n));break;case p.BRDM:O.onBroadcastMessageReceived(JSON.parse(n));break;case p.TPST:O.onTypeStartReceived(JSON.parse(n));break;case p.TPEN:O.onTypeEndReceived(JSON.parse(n));break;case p.PONG:s(p.PONG);break;case p.READ:O.onReadReceived(JSON.parse(n));break;default:O.onUndefinedMessageReceived(e,JSON.parse(n))}return JSON.parse(n)},N={successFunc:function(e){},errorFunc:function(e,n){console.log(e),console.log(n)}},O={onMessageReceived:function(e){console.log(e)},onSystemMessageReceived:function(e){console.log(e)},onFileMessageReceived:function(e){console.log(e)},onBroadcastMessageReceived:function(e){console.log(e)},onReadReceived:function(e){console.log(e)},onMessagingChannelUpdateReceived:function(e){console.log(e)},onTypeStartReceived:function(e){console.log(e)},onTypeEndReceived:function(e){console.log(e)},onMessageDelivery:function(e){console.log(e)},onUndefinedMessageReceived:function(e,n){s(e),s(n)}},b=6,P=5,L=function(n){s("=== Start SendBird SDK ===");var a=i({},N,n),o="guest_login/",c={guest_id:d.guest_id,app_id:d.app_id,nickname:d.user_name,image_url:d.image_url,access_token:d.access_token};e(r(o),c,function(e){e.error?a.errorFunc(t,e.message):(d.guest_key=e.key,a.successFunc({}))},function(e,n){a.errorFunc(e,n)})},E=function(n,a){s("=== Join Channel ===");var o=i({},N,a),c="channel_join/",u={app_id:d.app_id,session_key:d.guest_key,channel_url:n},g={};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):(e.isMessaging=!1,i(_,e),g=_,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},I=function(n,a){s("=== Leave Channel ===");var o=i({},N,a),c="channel_leave",u={app_id:d.app_id,session_key:d.guest_key,channel_url:n},g={};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},C=function(n,a){s("=== Member List ===");var o=i({},N,a),c="member_list/",u={app_id:d.app_id,channel_url:n},g={};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},D=function(n){s("=== Channel List ==="),n=i({},{limit:20,page:1,query:""},n);var a=i({},N,n),o="channel_list/",c={app_id:d.app_id,page:a.page,limit:a.limit,query:a.query},u={};e(r(o),c,function(e){e.error?a.errorFunc(t,e.message):(u=e,a.successFunc(u))},function(e,n){a.errorFunc(e,n)})},w=function(e){D(e)},J=function(e){if(void 0!=e.last_message&&""!=e.last_message){var n=JSON.parse(e.last_message.substring(4));e.last_message=n.message,e.last_message_ts=n.sts}else e.last_message="",e.last_message_ts=0;return e},G=function(n,a){s("=== Join Messaging Channel ===");var o=i({},N,a),c="messaging_join/",u={app_id:d.app_id,session_key:d.guest_key,channel_url:n},g={};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):(e.channel.isMessaging=!0,i(_,e.channel),g=e,o.successFunc(J(g)))},function(e,n){o.errorFunc(e,n)})},U=function(n,a){s("=== Start Messaging ==="),n=n instanceof Array?n:new Array(n);var o=i({},N,a),c="messaging_start/",u={app_id:d.app_id,session_key:d.guest_key,guest_ids:n},g={};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):(i(_,e.channel),g=e,o.successFunc(J(g)))},function(e,n){o.errorFunc(e,n)})},W=function(n,a){s("=== Invite Messaging ==="),n=n instanceof Array?n:new Array(n);var o=i({},N,a),c="messaging_invite/",u=o.channel_url;(void 0==u||""==u)&&(u=_.channel_url);var g={app_id:d.app_id,session_key:d.guest_key,channel_url:u,guest_ids:n},l={};e(r(c),g,function(e){e.error?o.errorFunc(t,e.message):(i(_,e.channel),l=e,o.successFunc(J(l)))},function(e,n){o.errorFunc(e,n)})},j=function(n,a){s("=== End Messaging ===");var o=i({},N,a),c="messaging_end/",u={app_id:d.app_id,session_key:d.guest_key,channel_url:n},g={};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):(i(_,e),g=e,o.successFunc(J(g)))},function(e,n){o.errorFunc(e,n)})},x=function(n){s("=== Messaging Channel List ==="),n=i({},{limit:9999,page:1},n);var a=i({},N,n),o="messaging_list/",c={app_id:d.app_id,session_key:d.guest_key,page:a.page,limit:a.limit},u={};e(r(o),c,function(e){e.error?a.errorFunc(t,e.message):(u=e,u.channels.forEach(function(e,n){e=J(e)}),a.successFunc(u))},function(e,n){a.errorFunc(e,n)})},A=function(n){s("=== Messaging Channel List ==="),n=i({},{limit:9999,page:1},n);var a=i({},N,n),r="messaging_list/",c={app_id:d.app_id,session_key:d.guest_key,page:a.page,limit:a.limit},u={};e(o(r),c,function(e){e.error?a.errorFunc(t,e.message):(u=e,u.channels.forEach(function(e,n){e=J(e)}),a.successFunc(u))},function(e,n){a.errorFunc(e,n)})},B=function(n,a){s("=== Messaging Channel Info ===");var o=i({},N,a),c="messaging_info/",u={app_id:d.app_id,session_key:d.guest_key,channel_id:n};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):O.onMessagingChannelUpdateReceived(J(e))},function(e,n){o.errorFunc(e,n)})},q=function(n,a){s("=== Message Mark As Read ===");var o=i({},N,a),c="mark_as_read/",u={app_id:d.app_id,session_key:d.guest_key,channel_url:n},g={};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},z=function(n){s("=== Message Load More ==="),n=i({},{limit:20},n);var a=i({},N,n),o=(new Date).getTime(),c="message_list",u={app_id:d.app_id,session_key:d.guest_key,channel_url:_.channel_url,message_ts:0==v?o:v,prev_limit:a.limit,next_limit:0,include:!1},g=[];e(r(c),u,function(e){e.error?a.errorFunc(t,e.message):(e.messages.forEach(function(e,n){var s=JSON.parse(e.substring(4));0==v?v=s.ts:v>s.ts&&(v=s.ts),g.push(pe(e))}),a.successFunc({messages:g}))},function(e,n){a.errorFunc(e,n)})},H=function(n){s("=== User List ==="),n=i({},{token:"",page:1,limit:30},n);var a=i({},N,n),o="user_list/",c={app_id:d.app_id,session_key:d.guest_key,token:a.token,page:a.page,limit:a.limit};e(r(o),c,function(e){e.error?a.errorFunc(t,e.message):a.successFunc(e)},function(e,n){a.errorFunc(e,n)})},Y=function(e,n){s("=== Upload File ===");var r=i({},N,n),o="upload_file/",c='{"app_id": "'+d.app_id+'"}',g=new FormData;g.append("meta",c),g.append("file",e);var f="",p=l+"v"+u.replace(/[^(0-9)]/gi,"")+"/"+o,_=new XMLHttpRequest;_.open("POST",p,r.async),_.onload=function(){if(_.status>=t&&_.status<a){var n=_.responseText,s=JSON.parse(n);s.error?r.errorFunc(t,s.message):(f={error:!1,url:s.url},le({url:s.url,name:e.name,type:e.type,size:e.size,custom:""}),r.successFunc(f))}else r.errorFunc(_.status,_.statusText)},_.send(g)},X=function(){s("=== Typing Start ===");var e=(new Date).getTime();ie(p.TPST,{channel_id:_.id,time:e}),S=e,k=!0},K=function(){s("=== Typing End ===");var e=(new Date).getTime();ie(p.TPEN,{channel_id:_.id,time:e}),S=0,k=!1},Q=(setInterval(function(){var e=(new Date).getTime();k&&e-S>T&&K()},T),function(n,a){s("=== Delete Message ===");var o=i({},N,a),c="message_delete/",u={app_id:d.app_id,session_key:d.guest_key,msg_id:n};e(r(c),u,function(e){e.error?o.errorFunc(t,e.message):o.successFunc(e)},function(e,n){o.errorFunc(e,n)})}),V=function(e){s("=== Web Socket Connect ==="),ne();var n=i({},N,e);f=new WebSocket(g),f.onopen=function(e){te(d.guest_key);var s=(new Date).getTime();if(void 0===_.id||ae(_.id,s)){var i={};n.successFunc(i)}else n.errorFunc(a,"WebSocket is not connected yet.");oe(!0)},f.onmessage=function(e){m=(new Date).getTime();for(var n=e.data.split("\n"),s=0;s<n.length;s++)if(0!=n[s].trim().length){var i=n[s].substring(0,4),t=n[s].substring(4);if(0!==i.trim().length||0!==t.trim().length)if(i===p.PONG)ce(!1);else if(i==p.MCUP){var a=JSON.parse(t);B(a.channel_id)}else R(i,t)}},f.onerror=function(e){s("=== Web Socket onerror ==="),s(e),_isLeavingPage||$(),oe(!1),ce(!1)},f.onclose=function(e){s("=== Web Socket onclose ==="),s(e),_isLeavingPage||$(),oe(!1),ce(!1)}},Z=function(){s("=== Web Socket Disconnect ==="),ee()},$=function(){null==y?(s("=== Start Reconnect ==="),y=setTimeout(function(){V(),y=null,s("=== Reconnect done ===")},3e3)):s("=== Reconnect is in progress. (skip) ===")},ee=function(){f&&ne(),_={},v=0,h=null,F=null,y=null,M=0},ne=function(){f&&(f.close(),f.onmessage=function(e){},f.onopen=function(e){},f.onerror=function(e){},f.onclose=function(e){},f=null),v=0},se=function(){return f?f.readyState:WebSocket.CLOSED},ie=function(e,n){var s=e+JSON.stringify(n)+"\n";try{if(1!=f.readyState)return!1;f.send(s)}catch(i){return console.log(i),!1}return!0},te=function(e){ie(p.LOGI,{key:e})},ae=function(e,n){return ie(p.JOIN,{channel_id:e,last_ts:n})},re=function(){var e=(new Date).getTime();M=e,ie(p.PING,{id:e})},oe=function(e){null!=h&&(clearInterval(h),h=null),e?(s("=== Start Pinger ==="),h=setInterval(function(){var e=(new Date).getTime(),n=e-m,i=parseInt(n/1e3);i>0&&i%5==0&&(s(p.PING),re(),ce(!0))},1e3)):s("=== Stop Pinger ===")},ce=function(e){null!=F&&(clearInterval(F),F=null),e?(s("=== Start Watchdog ==="),F=setInterval(function(){var e=(new Date).getTime(),n=e-m,i=parseInt(n/1e3);i>=20&&(s("=== Watchdog Barks! ==="),oe(!1),$())},4500)):s("=== Watchdog ===")},ue=function(e,n){n=n||"";var s=ie(p.MESG,{channel_id:_.id,message:e,data:"",tid:n});O.onMessageDelivery({sent:s,message:e,data:"",id:n}),s&&setTimeout(function(){K()},100)},ge=function(e,n,s){s=s||"";var i=ie(p.MESG,{channel_id:_.id,message:e,data:n,tid:s});O.onMessageDelivery({sent:i,message:e,data:n,tid:s}),i&&setTimeout(function(){K()},100)},le=function(e){ie(p.FILE,{channel_id:_.id,name:e.name,url:e.url,type:e.type,size:e.size,custom:e.custom})},fe=function(e){n=e},pe=function(e){var n=e.substring(0,4),s=JSON.parse(e.substring(4));return{cmd:n,payload:s}},de=function(e){return e==p.MESG},_e=function(e){return e==p.FILE},me=function(e){var n=e.url.split("."),s=n[n.length-1];return"png"==s||"jpeg"==s||"jpg"==s||"gif"==s||"bmp"==s?!0:e.type.indexOf("image")>=0},ve=function(e){return e==b},he=function(e){return e==P},Fe=function(e){e({channel_url:_.channel_url,cover_img_url:_.cover_img_url,member_count:_.member_count,name:_.name,isMessaging:_.isMessaging})},ye=function(e){e({guest_id:d.guest_id,image_url:d.image_url,nickname:d.user_name})},Me="[version] 2.2.0";return{version:Me,events:O,joinChannel:E,leaveChannel:I,getMemberList:C,getChannelSearch:D,getChannelList:w,joinMessagingChannel:G,startMessaging:U,inviteMessaging:W,endMessaging:j,getMessagingChannelList:x,getPrivateChannelList:A,markAsRead:q,getMessageLoadMore:z,getUserList:H,sendFile:Y,typeStart:X,typeEnd:K,deleteMessage:Q,connect:V,disconnect:Z,message:ue,messageWithData:ge,sendFileURL:le,setDebugMessage:fe,isMessage:de,isFileMessage:_e,hasImage:me,isGroupMessaging:ve,isGroupMessagingChannel:ve,isMessagingChannel:he,getChannelInfo:Fe,getUserInfo:ye,getConnectionState:se,init:c}}();return r});