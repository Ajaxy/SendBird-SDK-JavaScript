/**
 * SendBird JavaScript SDK v2.4.1
 */
var _isLeavingPage=!1;"object"==typeof window&&(window.onbeforeunload=function(){_isLeavingPage=!0}),function(e,n){"function"==typeof define&&define.amd?define([],n()):"object"==typeof exports?module.exports=n():e.SB=n()}(this,function(){function e(e,n,t,a){var c=new XMLHttpRequest;try{c=new XMLHttpRequest,c.open("POST",e),c.onload=function(){if(c.status>=r&&c.status<i){var e=c.responseText;t(JSON.parse(e))}else a(c.status,c.statusText)},c.onerror=function(){s("onerror ",c),a(404,"There was a connection error")}}catch(o){c=new ActiveXObject("Microsoft.XMLHTTP"),c.open("post",e),c.onreadystatechange=function(){if(4==c.readyState)if(c.status>=r&&c.status<i){var e=c.responseText;t(JSON.parse(e))}else a(c.status,c.statusText)}}c.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),c.send(JSON.stringify(n))}var n=!1,s=function(e){n&&console.log(e)},t=function(e){e=e||{};for(var n=arguments.length,s=1;n>s;s++)if(arguments[s])for(var t in arguments[s])arguments[s].hasOwnProperty(t)&&(e[t]=arguments[s][t]);return e};"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var r=200,i=400,a=function(){function e(){var e=new c;return e}var n,s=function(s){var r=t({},{newInstance:!1},s);return r.newInstance?e():(n||(n=e()),n)};return{getInstance:s}}(),c=function(){function a(e){return l+"v"+u.replace(/[^(0-9)]/gi,"")+"/"+e}function c(e){return l+"v3/"+e}function o(e){_.app_id=e.app_id,_.guest_id=e.guest_id,_.user_name=e.user_name,_.image_url=void 0==e.image_url||null==e.image_url?"":e.image_url,_.access_token=void 0==e.access_token||null==e.access_token?"":e.access_token,L({successFunc:function(n){e.successFunc(n)},errorFunc:function(n,s){e.errorFunc(n,s)},async:e.async})}var u="1",g="wss://ws.jiver.co:9010",l="https://api.sendbird.com/",f=null,p={MESG:"MESG",FILE:"FILE",LOGI:"LOGI",JOIN:"JOIN",SYSM:"SYSM",BRDM:"BRDM",MCUP:"MCUP",READ:"READ",TPST:"TPST",TPEN:"TPEN",BAAN:"BAAN",FREZ:"FREZ",PING:"PING",PONG:"PONG"},_={},d={},m=0,v=0,h=null,y=null,F=null,k=0,S=!1,M=0,T=1e4,R=function(e,n){switch(e){case p.MESG:O.onMessageReceived(JSON.parse(n));break;case p.SYSM:O.onSystemMessageReceived(JSON.parse(n));break;case p.FILE:O.onFileMessageReceived(JSON.parse(n));break;case p.BRDM:O.onBroadcastMessageReceived(JSON.parse(n));break;case p.TPST:O.onTypeStartReceived(JSON.parse(n));break;case p.TPEN:O.onTypeEndReceived(JSON.parse(n));break;case p.PONG:s(p.PONG);break;case p.READ:O.onReadReceived(JSON.parse(n));break;case p.BAAN:O.onBanReceived(JSON.parse(n));break;case p.FREZ:var t=JSON.parse(n),r=!1;try{r=t.freeze}catch(i){r=!1}d.data=JSON.stringify({freeze:r}),O.onChannelFreezeReceived(t);break;default:O.onUndefinedMessageReceived(e,JSON.parse(n))}return JSON.parse(n)},N={successFunc:function(e){},errorFunc:function(e,n){s(e),s(n)}},O={onMessageReceived:function(e){s(e)},onSystemMessageReceived:function(e){s(e)},onFileMessageReceived:function(e){s(e)},onBroadcastMessageReceived:function(e){s(e)},onReadReceived:function(e){s(e)},onMessagingChannelUpdateReceived:function(e){s(e)},onTypeStartReceived:function(e){s(e)},onTypeEndReceived:function(e){s(e)},onMessageDelivery:function(e){s(e)},onBanReceived:function(e){s(e)},onChannelFreezeReceived:function(e){s(e)},onUndefinedMessageReceived:function(e,n){s(e),s(n)}},b=6,P=5,L=function(n){s("=== Start SendBird SDK ===");var i=t({},N,n),c="guest_login/",o={guest_id:_.guest_id,app_id:_.app_id,nickname:_.user_name,image_url:_.image_url,access_token:_.access_token};void 0!=_.gcm_reg_token&&""!=_.gcm_reg_token&&(o.gcm_reg_token=_.gcm_reg_token),void 0!=_.apns_device_token&&""!=_.apns_device_token&&(o.apns_device_token=_.apns_device_token),e(a(c),o,function(e){e.error?i.errorFunc(r,e.message):(_.guest_key=e.key,i.successFunc({}))},function(e,n){i.errorFunc(e,n)})},E=function(n,i){s("=== Join Channel ===");var c=t({},N,i),o="channel_join/",u={app_id:_.app_id,session_key:_.guest_key,channel_url:n},g={};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):(e.isMessaging=!1,t(d,e),g=d,c.successFunc(g))},function(e,n){c.errorFunc(e,n)})},I=function(n,i){s("=== Leave Channel ===");var c=t({},N,i),o="channel_leave",u={app_id:_.app_id,session_key:_.guest_key,channel_url:n},g={};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):(g=e,c.successFunc(g))},function(e,n){c.errorFunc(e,n)})},w=function(n,i){s("=== Member List ===");var c=t({},N,i),o="member_list/",u={app_id:_.app_id,channel_url:n},g={};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):(g=e,c.successFunc(g))},function(e,n){c.errorFunc(e,n)})},C=function(n){s("=== Channel List ==="),n=t({},{limit:20,page:1,query:""},n);var i=t({},N,n),c="channel_list/",o={app_id:_.app_id,page:i.page,limit:i.limit,query:i.query},u={};e(a(c),o,function(e){e.error?i.errorFunc(r,e.message):(u=e,i.successFunc(u))},function(e,n){i.errorFunc(e,n)})},J=function(e){C(e)},D=function(e){return void 0!=e.last_message&&""!=e.last_message&&(e.last_message=JSON.parse(e.last_message.substring(4))),e},G=function(n,i){s("=== Join Messaging Channel ===");var c=t({},N,i),o="messaging_join/",u={app_id:_.app_id,session_key:_.guest_key,channel_url:n},g={};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):(e.channel.isMessaging=!0,t(d,e.channel),g=e,c.successFunc(D(g)))},function(e,n){c.errorFunc(e,n)})},A=function(n,i){s("=== Start Messaging ==="),n=n instanceof Array?n:new Array(n);var c=t({},N,i),o="messaging_start/",u={app_id:_.app_id,session_key:_.guest_key,guest_ids:n},g={};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):(t(d,e.channel),g=e,c.successFunc(D(g)))},function(e,n){c.errorFunc(e,n)})},x=function(e,n,s){if(2==arguments.length){var t=arguments[1].channel_url;(void 0==t||""==t)&&(t=d.channel_url),B(arguments[0],t,arguments[1])}else B(e,n,s)},B=function(n,i,c){s("=== Invite Messaging ==="),n=n instanceof Array?n:new Array(n);var o=t({},N,c),u="messaging_invite/",g={app_id:_.app_id,session_key:_.guest_key,channel_url:i,guest_ids:n},l={};e(a(u),g,function(e){e.error?o.errorFunc(r,e.message):(t(d,e.channel),l=e,o.successFunc(D(l)))},function(e,n){o.errorFunc(e,n)})},U=function(n,i){s("=== End Messaging ===");var c=t({},N,i),o="messaging_end/",u={app_id:_.app_id,session_key:_.guest_key,channel_url:n},g={};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):(t(d,e),g=e,c.successFunc(D(g)))},function(e,n){c.errorFunc(e,n)})},W=function(n){s("=== Messaging Channel List ==="),n=t({},{limit:9999,page:1},n);var i=t({},N,n),c="messaging_list/",o={app_id:_.app_id,session_key:_.guest_key,page:i.page,limit:i.limit},u={};e(a(c),o,function(e){e.error?i.errorFunc(r,e.message):(u=e,u.channels.forEach(function(e,n){e=D(e)}),i.successFunc(u))},function(e,n){i.errorFunc(e,n)})},j=function(n){s("=== Messaging Channel List ==="),n=t({},{limit:9999,page:1},n);var i=t({},N,n),a="messaging_list/",o={app_id:_.app_id,session_key:_.guest_key,page:i.page,limit:i.limit},u={};e(c(a),o,function(e){e.error?i.errorFunc(r,e.message):(u=e,u.channels.forEach(function(e,n){e=D(e)}),i.successFunc(u))},function(e,n){i.errorFunc(e,n)})},z=function(n,i){s("=== Messaging Channel Info ===");var c=t({},N,i),o="messaging_info/",u={app_id:_.app_id,session_key:_.guest_key,channel_id:n};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):O.onMessagingChannelUpdateReceived(D(e))},function(e,n){c.errorFunc(e,n)})},q=function(n,i){s("=== Message Mark As Read ===");var c=t({},N,i),o="mark_as_read/",u={app_id:_.app_id,session_key:_.guest_key,channel_url:n},g={};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):(g=e,c.successFunc(g))},function(e,n){c.errorFunc(e,n)})},H=function(n){s("=== Message Load More ==="),n=t({},{limit:20},n);var i=t({},N,n),c=(new Date).getTime(),o="message_list",u={app_id:_.app_id,session_key:_.guest_key,channel_url:d.channel_url,message_ts:0==v?c:v,prev_limit:i.limit,next_limit:0,include:!1},g=[];e(a(o),u,function(e){e.error?i.errorFunc(r,e.message):(e.messages.forEach(function(e,n){var s=JSON.parse(e.substring(4));0==v?v=s.ts:v>s.ts&&(v=s.ts),g.push(_e(e))}),i.successFunc({messages:g}))},function(e,n){i.errorFunc(e,n)})},X=function(n){s("=== User List ==="),n=t({},{token:"",page:1,limit:30},n);var i=t({},N,n),c="user_list/",o={app_id:_.app_id,session_key:_.guest_key,token:i.token,page:i.page,limit:i.limit};e(a(c),o,function(e){e.error?i.errorFunc(r,e.message):i.successFunc(e)},function(e,n){i.errorFunc(e,n)})},Y=function(e,n){s("=== Upload File ===");var a=t({},N,n),c="upload_file/",o='{"app_id": "'+_.app_id+'"}',g=new FormData;g.append("meta",o),g.append("file",e);var f="",p=l+"v"+u.replace(/[^(0-9)]/gi,"")+"/"+c,d=new XMLHttpRequest;d.open("POST",p,a.async),d.onload=function(){if(d.status>=r&&d.status<i){var n=d.responseText,s=JSON.parse(n);s.error?a.errorFunc(r,s.message):(f={error:!1,url:s.url},fe({url:s.url,name:e.name,type:e.type,size:e.size,custom:""}),a.successFunc(f))}else a.errorFunc(d.status,d.statusText)},d.send(g)},Z=function(){s("=== Typing Start ===");var e=(new Date).getTime();re(p.TPST,{channel_id:d.id,time:e}),M=e,S=!0},K=function(){s("=== Typing End ===");var e=(new Date).getTime();re(p.TPEN,{channel_id:d.id,time:e}),M=0,S=!1},$=(setInterval(function(){var e=(new Date).getTime();S&&e-M>T&&K()},T),function(n,i){s("=== Delete Message ===");var c=t({},N,i),o="message_delete/",u={app_id:_.app_id,session_key:_.guest_key,msg_id:n};e(a(o),u,function(e){e.error?c.errorFunc(r,e.message):c.successFunc(e)},function(e,n){c.errorFunc(e,n)})}),Q=function(e){s("=== Web Socket Connect ==="),se();var n=t({},N,e);f=new WebSocket(g),f.onopen=function(e){ie(_.guest_key);var s=(new Date).getTime();if(void 0===d.id||ae(d.id,s)){var t={};n.successFunc(t)}else n.errorFunc(i,"WebSocket is not connected yet.");oe(!0)},f.onmessage=function(e){m=(new Date).getTime();for(var n=e.data.split("\n"),s=0;s<n.length;s++)if(0!=n[s].trim().length){var t=n[s].substring(0,4),r=n[s].substring(4);if(0!==t.trim().length||0!==r.trim().length)if(t===p.PONG)ue(!1);else if(t==p.MCUP){var i=JSON.parse(r);z(i.channel_id)}else R(t,r)}},f.onerror=function(e){s("=== Web Socket onerror ==="),s(e),_isLeavingPage||ee(),oe(!1),ue(!1)},f.onclose=function(e){s("=== Web Socket onclose ==="),s(e),_isLeavingPage||ee(),oe(!1),ue(!1)}},V=function(){s("=== Web Socket Disconnect ==="),ne()},ee=function(){null==F?(s("=== Start Reconnect ==="),F=setTimeout(function(){Q(),F=null,s("=== Reconnect done ===")},3e3)):s("=== Reconnect is in progress. (skip) ===")},ne=function(){f&&se(),d={},v=0,h=null,y=null,F=null,k=0},se=function(){f&&(f.close(),f.onmessage=function(e){},f.onopen=function(e){},f.onerror=function(e){},f.onclose=function(e){},f=null),v=0},te=function(){return f?f.readyState:WebSocket.CLOSED},re=function(e,n){var t=e+JSON.stringify(n)+"\n";try{if(1!=f.readyState)return!1;f.send(t)}catch(r){return s(r),!1}return!0},ie=function(e){re(p.LOGI,{key:e})},ae=function(e,n){return re(p.JOIN,{channel_id:e,last_ts:n})},ce=function(){var e=(new Date).getTime();k=e,re(p.PING,{id:e})},oe=function(e){null!=h&&(clearInterval(h),h=null),e?(s("=== Start Pinger ==="),h=setInterval(function(){var e=(new Date).getTime(),n=e-m,t=parseInt(n/1e3);t>0&&t%5==0&&(s(p.PING),ce(),ue(!0))},1e3)):s("=== Stop Pinger ===")},ue=function(e){null!=y&&(clearInterval(y),y=null),e?(s("=== Start Watchdog ==="),y=setInterval(function(){var e=(new Date).getTime(),n=e-m,t=parseInt(n/1e3);t>=20&&(s("=== Watchdog Barks! ==="),oe(!1),ee())},4500)):s("=== Watchdog ===")},ge=function(e,n){n=n||"";var s=re(p.MESG,{channel_id:d.id,message:e,data:"",tid:n});O.onMessageDelivery({sent:s,message:e,data:"",id:n}),s&&d.isMessaging&&setTimeout(function(){K()},100)},le=function(e,n,s){s=s||"";var t=re(p.MESG,{channel_id:d.id,message:e,data:n,tid:s});O.onMessageDelivery({sent:t,message:e,data:n,tid:s}),t&&d.isMessaging&&setTimeout(function(){K()},100)},fe=function(e){re(p.FILE,{channel_id:d.id,name:e.name,url:e.url,type:e.type,size:e.size,custom:e.custom})},pe=function(e){n=e},_e=function(e){var n=e.substring(0,4),s=JSON.parse(e.substring(4));return{cmd:n,payload:s}},de=function(e){return e==p.MESG},me=function(e){return e==p.FILE},ve=function(e){var n=e.url.split("."),s=n[n.length-1];return"png"==s||"jpeg"==s||"jpg"==s||"gif"==s||"bmp"==s?!0:e.type.indexOf("image")>=0},he=function(e){return e==b},ye=function(e){return e==P},Fe=function(e){var n=!1;try{n=JSON.parse(d.data).freeze}catch(s){n=!1}e({channel_url:d.channel_url,cover_img_url:d.cover_img_url,member_count:d.member_count,name:d.name,isMessaging:d.isMessaging,max_length_message:d.max_length_message,freeze:n})},ke=function(e){e({guest_id:_.guest_id,image_url:_.image_url,nickname:_.user_name})},Se=function(e){_.gcm_reg_token=e},Me=function(e){_.apns_device_token=e},Te="[version] 2.4.1";return{version:Te,events:O,joinChannel:E,leaveChannel:I,getMemberList:w,getChannelSearch:C,getChannelList:J,joinMessagingChannel:G,startMessaging:A,inviteMessaging:x,endMessaging:U,getMessagingChannelList:W,getPrivateChannelList:j,markAsRead:q,getMessageLoadMore:H,getUserList:X,sendFile:Y,typeStart:Z,typeEnd:K,deleteMessage:$,connect:Q,disconnect:V,message:ge,messageWithData:le,sendFileURL:fe,setDebugMessage:pe,isMessage:de,isFileMessage:me,hasImage:ve,isGroupMessaging:he,isGroupMessagingChannel:he,isMessagingChannel:ye,getChannelInfo:Fe,getUserInfo:ke,getConnectionState:te,registerGCMToken:Se,registerAPNSToken:Me,init:o}};return a});