/**
 * SendBird JavaScript SDK v2.4.15
 */
!function(e,n){var t=n();"function"==typeof define&&define.amd?define([],t.getInstance()):"object"==typeof exports?(module.exports=t.getInstance(),module.exports.SB=t,module.exports.sendbird=t.getInstance()):(e.SB=t,e.sendbird=t.getInstance())}(this,function(){function e(){try{if("undefined"==typeof navigator||"undefined"==typeof navigator.userAgent)return!1;var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):!1}catch(n){return!1}}function n(n,r,s,i,a,o){var c=t?new t:new XMLHttpRequest,u=e();if(!("withCredentials"in c)&&u&&10>u){c=new XDomainRequest,c.withCredentials=!0;try{switch(s.toLowerCase()){case"get":c.open("GET",n);break;default:c.open("POST",n)}}catch(d){c.open("POST",n)}for(var _ in i)r[_]=i[_];c.onload=function(){var e=JSON.parse(c.responseText);e.error?o(c.status,c.statusText):a(e)},c.onerror=function(){o(404,"There was a connection error")}}else{try{switch(c=t?new t:new XMLHttpRequest,s.toLowerCase()){case"get":c.open("GET",n);break;default:c.open("POST",n)}c.onload=function(){if(c.status>=g&&c.status<p){var e=c.responseText;a(JSON.parse(e))}else o(c.status,c.statusText)},c.onerror=function(){o(404,"There was a connection error")}}catch(f){c=new ActiveXObject("Microsoft.XMLHTTP");try{switch(s.toLowerCase()){case"get":c.open("GET",n);break;default:c.open("POST",n)}}catch(d){c.open("POST",n)}c.onreadystatechange=function(){if(4==c.readyState)if(c.status>=g&&c.status<p){var e=c.responseText;a(JSON.parse(e))}else o(c.status,c.statusText)}}c.setRequestHeader("Content-Type","text/plain; charset=UTF-8");for(var _ in i)c.setRequestHeader(_,i[_])}switch(s.toLowerCase()){case"get":c.send();break;default:c.send(JSON.stringify(r))}}var t="undefined"==typeof window?require("xhr2"):null,r="undefined"==typeof WebSocket?require("websocket").w3cwebsocket:WebSocket,s=!1,i=!1;try{var a=window.console||{log:function(){}}}catch(o){var a={log:function(){}}}var c=function(e){s&&a.log(e)},u=function(e){e=e||{};for(var n=arguments.length,t=1;n>t;t++)if(arguments[t])for(var r in arguments[t])arguments[t].hasOwnProperty(r)&&(e[r]=arguments[t][r]);return e};"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var g=200,p=400,d=function(){function e(){var e=new _;return e}var n,t=function(t){var r=u({},{newInstance:!1},t);return r.newInstance?e():(n||(n=e()),n)};return{getInstance:t}}(),_=function(){function e(e){return _(k+C.app_id),l+"v"+S.replace(/[^(0-9)]/gi,"")+"/"+e}function o(e){return _(k+C.app_id),l+"v3/"+e}function d(){0!==O&&(F=3e3,M=5,O=0,c("=== Reset Reconnect Values ==="))}function _(e,t,r){if(v)m="ws://localtest.me:9000",l="http://api.localtest.me:8000/","function"==typeof t&&t();else{var s=(new Date).getTime()/1e3;0==U||U-s>300?n(e,{},"GET",{SendBird:R+C.app_id},function(e){m=e.ws_server,l=e.api_server+"/",c("Routing Info Update: "+m+", "+l),U=s,"function"==typeof t&&t()},function(e,n){"function"==typeof r&&r(e,n)}):"function"==typeof t&&t()}}function f(e){C.app_id=e.app_id,C.guest_id=e.guest_id,C.user_name=e.user_name,C.image_url=void 0==e.image_url||null==e.image_url?"":e.image_url,C.access_token=void 0==e.access_token||null==e.access_token?"":e.access_token,X({successFunc:function(n){e.successFunc(n)},errorFunc:function(n,t){e.errorFunc(n,t)},async:e.async})}var l,m,v=!1,S="1",k="https://sbrouting.sendbird.com/app/",y="2.4.15";try{var h=encodeURI(navigator.userAgent)}catch(T){var h="undefined"}var F,M,O,P="/?p=JS&pv="+h+"&sv="+y+"&ai=",R="JS,"+h+","+y+",",w=null,N={MESG:"MESG",FILE:"FILE",LOGI:"LOGI",JOIN:"JOIN",SYSM:"SYSM",BRDM:"BRDM",MCUP:"MCUP",READ:"READ",TPST:"TPST",TPEN:"TPEN",BAAN:"BAAN",FREZ:"FREZ",PING:"PING",PONG:"PONG"},C={},b={},I=0,E=0,B=null,G=null,L=null,J=0,D=!1,A=0,x=1e4,U=0;d();var q=function(e,n){switch(e){case N.MESG:H.onMessageReceived(JSON.parse(n));break;case N.SYSM:H.onSystemMessageReceived(JSON.parse(n));break;case N.FILE:H.onFileMessageReceived(JSON.parse(n));break;case N.BRDM:H.onBroadcastMessageReceived(JSON.parse(n));break;case N.TPST:H.onTypeStartReceived(JSON.parse(n));break;case N.TPEN:H.onTypeEndReceived(JSON.parse(n));break;case N.PONG:d(),c(N.PONG);break;case N.READ:H.onReadReceived(JSON.parse(n));break;case N.BAAN:H.onBanReceived(JSON.parse(n));break;case N.FREZ:var t=JSON.parse(n),r=!1;try{r=t.freeze}catch(s){r=!1}b.data=JSON.stringify({freeze:r}),H.onChannelFreezeReceived(t);break;default:H.onUndefinedMessageReceived(e,JSON.parse(n))}return JSON.parse(n)},z={successFunc:function(e){},errorFunc:function(e,n){c(e),c(n)}},H={onMessageReceived:function(e){c(e)},onSystemMessageReceived:function(e){c(e)},onFileMessageReceived:function(e){c(e)},onBroadcastMessageReceived:function(e){c(e)},onReadReceived:function(e){c(e)},onMessagingChannelUpdateReceived:function(e){c(e)},onTypeStartReceived:function(e){c(e)},onTypeEndReceived:function(e){c(e)},onMessageDelivery:function(e){c(e)},onBanReceived:function(e){c(e)},onChannelFreezeReceived:function(e){c(e)},onUndefinedMessageReceived:function(e,n){c(e),c(n)},onReconnectFailed:function(){}},W=6,j=5,X=function(t){c("=== Start SendBird SDK ===");var r=u({},z,t),s="guest_login/",i={guest_id:C.guest_id,app_id:C.app_id,nickname:C.user_name,image_url:C.image_url,access_token:C.access_token};void 0!=C.gcm_reg_token&&""!=C.gcm_reg_token&&(i.gcm_reg_token=C.gcm_reg_token),void 0!=C.apns_device_token&&""!=C.apns_device_token&&(i.apns_device_token=C.apns_device_token),_(k+C.app_id,function(){n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?r.errorFunc(g,e.message):(C.guest_key=e.key,C.remove_apns_token&&Ue(C.remove_apns_token),C.remove_gcm_token&&xe(C.remove_gcm_token),r.successFunc({}))},function(e,n){r.errorFunc(e,n)})},function(e,n){r.errorFunc(e,n)})},Y=function(t,r){c("=== Join Channel ===");var s=u({},z,r),i="channel_join/",a={app_id:C.app_id,session_key:C.guest_key,channel_url:t},o={};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):(e.isMessaging=!1,u(b,e),o=b,s.successFunc(o))},function(e,n){s.errorFunc(e,n)})},Z=function(t,r){c("=== Leave Channel ===");var s=u({},z,r),i="channel_leave",a={app_id:C.app_id,session_key:C.guest_key,channel_url:t},o={};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):(o=e,s.successFunc(o))},function(e,n){s.errorFunc(e,n)})},K=function(t,r){c("=== Member List ===");var s=u({},z,r),i="member_list/",a={app_id:C.app_id,channel_url:t},o={};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):(o=e,s.successFunc(o))},function(e,n){s.errorFunc(e,n)})},V=function(t){c("=== Channel List ==="),t=u({},{limit:20,page:1,query:""},t);var r=u({},z,t),s="channel_list/",i={app_id:C.app_id,page:r.page,limit:r.limit,query:r.query},a={};n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?r.errorFunc(g,e.message):(a=e,r.successFunc(a))},function(e,n){r.errorFunc(e,n)})},$=function(e){V(e)},Q=function(e){return void 0!=e.last_message&&""!=e.last_message&&(e.last_message=JSON.parse(e.last_message.substring(4))),e},ee=function(t,r){c("=== Join Messaging Channel ===");var s=u({},z,r),i="messaging_join/",a={app_id:C.app_id,session_key:C.guest_key,channel_url:t},o={};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):(e.channel.isMessaging=!0,u(b,e.channel),o=e,s.successFunc(Q(o)))},function(e,n){s.errorFunc(e,n)})},ne=function(t,r){c("=== Start Messaging ==="),r=u({},{is_group:!1},r),t=t instanceof Array?t:new Array(t);var s=u({},z,r),i="messaging_start/",a={app_id:C.app_id,session_key:C.guest_key,guest_ids:t,is_group:r.is_group},o={};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):(u(b,e.channel),o=e,s.successFunc(Q(o)))},function(e,n){s.errorFunc(e,n)})},te=function(e,n,t){if(2==arguments.length){var r=arguments[1].channel_url;void 0!=r&&""!=r||(r=b.channel_url),re(arguments[0],r,arguments[1])}else re(e,n,t)},re=function(t,r,s){c("=== Invite Messaging ==="),t=t instanceof Array?t:new Array(t);var i=u({},z,s),a="messaging_invite/",o={app_id:C.app_id,session_key:C.guest_key,channel_url:r,guest_ids:t},p={};n(e(a),o,"POST",{SendBird:R+C.app_id},function(e){e.error?i.errorFunc(g,e.message):(u(b,e.channel),p=e,i.successFunc(Q(p)))},function(e,n){i.errorFunc(e,n)})},se=function(t,r){c("=== End Messaging ===");var s=u({},z,r),i="messaging_end/",a={app_id:C.app_id,session_key:C.guest_key,channel_url:t},o={};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):(u(b,e),o=e,s.successFunc(Q(o)))},function(e,n){s.errorFunc(e,n)})},ie=function(t){c("=== Messaging Channel List ==="),t=u({},{limit:9999,page:1},t);var r=u({},z,t),s="messaging_list/",i={app_id:C.app_id,session_key:C.guest_key,page:r.page,limit:r.limit},a={};n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?r.errorFunc(g,e.message):(a=e,a.channels.forEach(function(e,n){e=Q(e)}),r.successFunc(a))},function(e,n){r.errorFunc(e,n)})},ae=function(e){c("=== Messaging Channel List ==="),e=u({},{limit:9999,page:1,show_empty:!1},e);var t=u({},z,e),r="messaging_list/",s={app_id:C.app_id,session_key:C.guest_key,page:t.page,limit:t.limit,show_empty:t.show_empty},i={};n(o(r),s,"POST",{SendBird:R+C.app_id},function(e){e.error?t.errorFunc(g,e.message):(i=e,i.channels.forEach(function(e,n){e=Q(e)}),t.successFunc(i))},function(e,n){t.errorFunc(e,n)})},oe=function(t,r){c("=== Messaging Channel Info ===");var s=u({},z,r),i="messaging_info/",a={app_id:C.app_id,session_key:C.guest_key,channel_id:t};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):H.onMessagingChannelUpdateReceived(Q(e))},function(e,n){s.errorFunc(e,n)})},ce=function(t,r){c("=== Message Mark As Read ===");var s=u({},z,r),i="mark_as_read/",a={app_id:C.app_id,session_key:C.guest_key,channel_url:t},o={};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):(o=e,s.successFunc(o))},function(e,n){s.errorFunc(e,n)})},ue=function(t){c("=== Message Load More ==="),t=u({},{limit:20},t);var r=u({},z,t),s=(new Date).getTime(),i="message_list",a={app_id:C.app_id,session_key:C.guest_key,channel_url:b.channel_url,message_ts:0==E?s:E,prev_limit:r.limit,next_limit:0,include:!1},o=[];n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?r.errorFunc(g,e.message):(e.messages.forEach(function(e,n){var t=JSON.parse(e.substring(4));0==E?E=t.ts:E>t.ts&&(E=t.ts),o.push(Ce(e))}),r.successFunc({messages:o}))},function(e,n){r.errorFunc(e,n)})},ge=function(t){c("=== User List ==="),t=u({},{token:"",page:1,limit:30},t);var r=u({},z,t),s="user_list/",i={app_id:C.app_id,session_key:C.guest_key,token:r.token,page:r.page,limit:r.limit};n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?r.errorFunc(g,e.message):r.successFunc(e)},function(e,n){r.errorFunc(e,n)})},pe=function(e,n){c("=== Upload File ===");var r=u({},z,n),s="upload_file/",i='{"app_id": "'+C.app_id+'"}',a=new FormData;a.append("meta",i),a.append("file",e);var o="",d=l+"v"+S.replace(/[^(0-9)]/gi,"")+"/"+s,_=void 0==r.async?!0:r.async,f=t?new t:new XMLHttpRequest;f.open("POST",d,_),f.onload=function(){if(f.status>=g&&f.status<p){var n=f.responseText,t=JSON.parse(n);t.error?r.errorFunc(g,t.message):(o={error:!1,url:t.url},we({url:t.url,name:e.name,type:e.type,size:e.size,custom:""}),r.successFunc(o))}else r.errorFunc(f.status,f.statusText)},f.send(a)},de=function(){c("=== Typing Start ===");var e=(new Date).getTime();he(N.TPST,{channel_id:b.id,time:e}),A=e,D=!0},_e=function(){c("=== Typing End ===");var e=(new Date).getTime();he(N.TPEN,{channel_id:b.id,time:e}),A=0,D=!1},fe=(setInterval(function(){var e=(new Date).getTime();D&&e-A>x&&_e()},x),function(t,r){c("=== Delete Message ===");var s=u({},z,r),i="message_delete/",a={app_id:C.app_id,session_key:C.guest_key,msg_id:t};n(e(i),a,"POST",{SendBird:R+C.app_id},function(e){e.error?s.errorFunc(g,e.message):s.successFunc(e)},function(e,n){s.errorFunc(e,n)})}),le=function(e){c("=== Web Socket Connect to Server ==="),ke();var n=u({},z,e);try{w=new r(m+P+C.app_id+"&key="+C.guest_key)}catch(t){a.log(t)}w.onopen=function(e){c("=== Web Socket Connected ==="),Oe(!0),Te(C.guest_key);var t=(new Date).getTime();if(void 0===b.id||Fe(b.id,t)){var r={};n.successFunc(r)}else n.errorFunc(p,"WebSocket is not connected yet.")},w.onmessage=function(e){I=(new Date).getTime();for(var n=e.data.split("\n"),t=0;t<n.length;t++)if(0!=n[t].trim().length){var r=n[t].substring(0,4),s=n[t].substring(4);if(0!==r.trim().length||0!==s.trim().length)if(r==N.MCUP){var i=JSON.parse(s);oe(i.channel_id)}else q(r,s)}},w.onerror=function(e){c("=== Web Socket onerror ==="),c(e)},w.onclose=function(e){c("=== Web Socket onclose ==="),c(e),i||ve(),Oe(!1)}},me=function(e){"undefined"==typeof e||1==e?(c("=== Web Socket Explicit Disconnect ==="),i=!0,Oe(!1),Se()):(c("=== Web Socket Disconnect ==="),i=e,ke())},ve=function(){i!==!0&&(null==L?M>O?(Se(),c("=== Start Reconnect (After "+(F/1e3).toString()+" Seconds) ==="),L=setTimeout(function(){O++,F*=2,le(),L=null,c("=== Reconnect done: "+O.toString()+" ===")},F)):(H.onReconnectFailed(),c("=== Stop Reconnect ===")):c("=== Reconnect is in progress. (skip) ==="))},Se=function(){w&&ke(),b={},E=0;try{clearInterval(B),c("=== clearInterval: pingHandler ===")}catch(e){c("=== clearInterval fail: pingHandler ===")}B=null;try{clearTimeout(L),c("=== clearTimeout: retryHandler ===")}catch(e){c("=== clearTimeout fail: retryHandler ===")}L=null,J=0},ke=function(){w&&(w.close(),w.onmessage=function(e){},w.onopen=function(e){},w.onerror=function(e){},w.onclose=function(e){},w=null),E=0},ye=function(){try{return w?w.readyState:r.CLOSED}catch(e){return r.CLOSED}},he=function(e,n){var t=e+JSON.stringify(n)+"\n";try{if(!w)return!1;if(1!=w.readyState)return!1;w.send(t)}catch(r){return c(r),!1}return!0},Te=function(e){he(N.LOGI,{key:e})},Fe=function(e,n){return he(N.JOIN,{channel_id:e,last_ts:n})},Me=function(){var e=(new Date).getTime();J=e,he(N.PING,{id:e})},Oe=function(e){null!=B&&(clearInterval(B),B=null),e?(c("=== Start Pinger ==="),B=setInterval(function(){var e=(new Date).getTime(),n=e-I,t=parseInt(n/1e3);t>0&&t%15==0&&(c(N.PING),Me(),clearTimeout(G),G=setTimeout(function(){var e=(new Date).getTime(),n=e-I,t=parseInt(n/1e3);t>=20&&(c("=== PING Timeout, Try Reconnect ==="),Oe(!1),Se(),ve())},6e3))},1e3)):c("=== Stop Pinger ===")},Pe=function(e,n){"string"!=typeof e&&(e=e.toString()),n=n||"","string"!=typeof n&&(n=n.toString());var t=he(N.MESG,{channel_id:b.id,message:e,data:"",tid:n});H.onMessageDelivery({sent:t,message:e,data:"",id:n}),t&&b.isMessaging&&setTimeout(function(){_e()},100)},Re=function(e,n,t){"string"!=typeof e&&(e=e.toString()),t=t||"","string"!=typeof t&&(t=t.toString());var r=he(N.MESG,{channel_id:b.id,message:e,data:n,tid:t});H.onMessageDelivery({sent:r,message:e,data:n,tid:t}),r&&b.isMessaging&&setTimeout(function(){_e()},100)},we=function(e){he(N.FILE,{channel_id:b.id,name:e.name,url:e.url,type:e.type,size:e.size,custom:e.custom})},Ne=function(e){s=e},Ce=function(e){var n=e.substring(0,4),t=JSON.parse(e.substring(4));return{cmd:n,payload:t}},be=function(e){return e==N.MESG},Ie=function(e){return e==N.FILE},Ee=function(e){var n=e.url.split("."),t=n[n.length-1];return"png"==t||"jpeg"==t||"jpg"==t||"gif"==t||"bmp"==t?!0:e.type.indexOf("image")>=0},Be=function(e){return e==W},Ge=function(e){return e==j},Le=function(e){var n=!1;try{n=JSON.parse(b.data).freeze}catch(t){n=!1}e({channel_url:b.channel_url,cover_img_url:b.cover_img_url,member_count:b.member_count,name:b.name,isMessaging:b.isMessaging,max_length_message:b.max_length_message,freeze:n})},Je=function(e){e({guest_id:C.guest_id,image_url:C.image_url,nickname:C.user_name})},De=function(t,r){if(C.guest_key){c("=== Start registerGCMToken ===");var s="register_push_token/",i={app_id:C.app_id,session_key:C.guest_key,gcm_reg_token:t},a=u({},z,r);n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?(c("=== Fail registerGCMToken ==="),C.gcm_reg_token=t,a.errorFunc(g,e.message)):(c("=== Success registerGCMToken ==="),a.successFunc(e))},function(e,n){C.gcm_reg_token=t,a.errorFunc(e,n)})}else C.gcm_reg_token=t},Ae=function(t,r){if(C.guest_key){c("=== Start registerAPNSToken ===");var s="register_push_token/",i={app_id:C.app_id,session_key:C.guest_key,apns_device_token:t},a=u({},z,r);n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?(c("=== Fail registerAPNSToken ==="),C.apns_device_token=t,a.errorFunc(g,e.message)):(c("=== Success registerAPNSToken ==="),a.successFunc(e))},function(e,n){C.apns_device_token=t,a.errorFunc(e,n)})}else C.apns_device_token=t},xe=function(t,r){if(C.guest_key){c("=== Start unregisterGCMToken ===");var s="unregister_push_token/",i={app_id:C.app_id,session_key:C.guest_key,gcm_reg_token:t},a=u({},z,r);n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?(c("=== Fail unregisterGCMToken ==="),C.remove_gcm_token=t,a.errorFunc(g,e.message)):(c("=== Success unregisterGCMToken ==="),C.remove_gcm_token="",a.successFunc(e))},function(e,n){c("=== Fail unregisterGCMToken ==="),C.remove_gcm_token=t,a.errorFunc(e,n)})}else C.remove_gcm_token=t},Ue=function(t,r){if(C.guest_key){c("=== Start unregisterAPNSToken ===");var s="unregister_push_token/",i={app_id:C.app_id,session_key:C.guest_key,apns_device_token:t},a=u({},z,r);n(e(s),i,"POST",{SendBird:R+C.app_id},function(e){e.error?(c("=== Fail unregisterAPNSToken ==="),C.remove_apns_token=t,a.errorFunc(g,e.message)):(C.remove_apns_token="",a.successFunc(e))},function(e,n){c("=== Fail unregisterAPNSToken ==="),C.remove_apns_token=t,a.errorFunc(e,n)})}else C.remove_apns_token=t},qe="[version] "+y,ze=function(e){E="string"==typeof e?parseInt(e):e};return{version:qe,events:H,joinChannel:Y,leaveChannel:Z,getMemberList:K,getChannelSearch:V,getChannelList:$,joinMessagingChannel:ee,startMessaging:ne,inviteMessaging:te,endMessaging:se,getMessagingChannelList:ie,getPrivateChannelList:ae,markAsRead:ce,getMessageLoadMore:ue,getUserList:ge,sendFile:pe,typeStart:de,typeEnd:_e,deleteMessage:fe,connect:le,disconnect:me,message:Pe,messageWithData:Re,sendFileURL:we,setDebugMessage:Ne,isMessage:be,isFileMessage:Ie,hasImage:Ee,isGroupMessaging:Be,isGroupMessagingChannel:Be,isMessagingChannel:Ge,getChannelInfo:Le,getUserInfo:Je,getConnectionState:ye,registerGCMToken:De,registerAPNSToken:Ae,unregisterGCMToken:xe,unregisterAPNSToken:Ue,init:f,setMinMessageTs:ze}};return d});